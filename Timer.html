<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é‹å‹•å¾ªç’°è¨ˆæ™‚å™¨</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #121212;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            transition: background-color 0.5s; /* åˆ‡æ›ç‹€æ…‹æ™‚èƒŒæ™¯é¡è‰²æœƒæ·¡å…¥æ·¡å‡º */
        }
        /* é‹å‹•ä¸­èƒŒæ™¯è®Šç¶ è‰²ï¼Œä¼‘æ¯ä¸­èƒŒæ™¯è®Šè—è‰² */
        body.working { background-color: #1b5e20; }
        body.resting { background-color: #0d47a1; }

        #status { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        #display { font-size: 100px; font-family: monospace; margin-bottom: 10px; }
        #cycle-info { font-size: 20px; color: #ccc; margin-bottom: 30px; }

        .settings {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .settings label { display: block; font-size: 14px; margin-bottom: 5px; }
        input { width: 80px; padding: 8px; border-radius: 5px; border: none; text-align: center; font-size: 16px; }

        .btns button {
            padding: 15px 30px;
            font-size: 20px;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            margin: 5px;
            font-weight: bold;
        }
        .start { background-color: #4caf50; color: white; }
        .stop { background-color: #f44336; color: white; }
        .reset { background-color: #757575; color: white; }
        button:disabled { opacity: 0.3; }
    </style>
</head>
<body id="body">

    <div id="status">æº–å‚™é–‹å§‹</div>
    <div id="display">00.00</div>
    <div id="cycle-info">å‰©é¤˜çµ„æ•¸: --</div>

    <div class="settings">
        <div>
            <label>é‹å‹•ç§’æ•¸</label>
            <input type="number" id="workSec" value="30">
        </div>
        <div>
            <label>ä¼‘æ¯ç§’æ•¸</label>
            <input type="number" id="restSec" value="10">
        </div>
        <div style="grid-column: span 2;">
            <label>ç¸½çµ„æ•¸</label>
            <input type="number" id="totalSets" value="3" style="width: 95%;">
        </div>
    </div>

    <div class="btns">
        <button id="startBtn" class="start" onclick="startWorkout()">é–‹å§‹é‹å‹•</button>
        <button id="stopBtn" class="stop" onclick="stopTimer()">æš«åœ</button>
        <button class="reset" onclick="resetTimer()">é‡è¨­</button>
    </div>

    <audio id="beepWork" src="https://actions.google.com/sounds/v1/cartoon/woodpecker.ogg"></audio>
    <audio id="beepDone" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

    <script>
        let timerInterval = null;
        let remainingTime = 0;
        let currentSet = 1;
        let isWorking = true; // true: é‹å‹•ä¸­, false: ä¼‘æ¯ä¸­

        function updateDisplay(time) {
            let ss = Math.floor(time / 1000);
            let ms = Math.floor((time % 1000) / 10);
            document.getElementById("display").innerText = 
                `${ss.toString().padStart(2, "0")}.${ms.toString().padStart(2, "0")}`;
        }

        function startWorkout() {
            if (timerInterval) return;

            // ç¬¬ä¸€æ¬¡å•Ÿå‹•åˆå§‹åŒ–
            if (remainingTime <= 0) {
                currentSet = 1;
                isWorking = true;
                setupState();
            }

            document.getElementById("startBtn").disabled = true;
            let lastTime = Date.now();

            timerInterval = setInterval(() => {
                let now = Date.now();
                remainingTime -= (now - lastTime);
                lastTime = now;

                if (remainingTime <= 0) {
                    switchState();
                }
                updateDisplay(remainingTime);
            }, 10);
        }

        function setupState() {
            const body = document.getElementById("body");
            const status = document.getElementById("status");
            const sets = document.getElementById("totalSets").value;
            
            if (isWorking) {
                remainingTime = document.getElementById("workSec").value * 1000;
                status.innerText = "ğŸ’ª é‹å‹•ä¸­ï¼";
                body.className = "working";
                document.getElementById("beepWork").play();
            } else {
                remainingTime = document.getElementById("restSec").value * 1000;
                status.innerText = "â˜• ä¼‘æ¯æ™‚é–“";
                body.className = "resting";
                document.getElementById("beepWork").play();
            }
            document.getElementById("cycle-info").innerText = `ç¬¬ ${currentSet} çµ„ / å…± ${sets} çµ„`;
        }

        function switchState() {
            const totalSets = document.getElementById("totalSets").value;

            if (isWorking) {
                // é‹å‹•å®Œåˆ‡æ›åˆ°ä¼‘æ¯
                isWorking = false;
                setupState();
            } else {
                // ä¼‘æ¯å®Œåˆ‡æ›åˆ°ä¸‹ä¸€çµ„é‹å‹•
                currentSet++;
                if (currentSet > totalSets) {
                    finishWorkout();
                } else {
                    isWorking = true;
                    setupState();
                }
            }
        }

        function finishWorkout() {
            clearInterval(timerInterval);
            timerInterval = null;
            remainingTime = 0;
            document.getElementById("status").innerText = "ğŸ‰ è¨“ç·´å®Œæˆï¼";
            document.getElementById("body").className = "";
            document.getElementById("startBtn").disabled = false;
            document.getElementById("beepDone").play();
            // alert("æ­å–œï¼ä½ å®Œæˆäº†æ‰€æœ‰è¨“ç·´ï¼");
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            document.getElementById("startBtn").disabled = false;
        }

        function resetTimer() {
            stopTimer();
            remainingTime = 0;
            document.getElementById("display").innerText = "00.00";
            document.getElementById("status").innerText = "æº–å‚™é–‹å§‹";
            document.getElementById("body").className = "";
        }
    </script>
</body>
</html>